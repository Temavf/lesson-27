# 27. Архитектура сетей

## Задание

[Методичка](https://docs.google.com/document/d/1rQH5M2MYclBkvmv3SO4wl4F_IErcojl86hD10ric6Lk/edit)

* Соединить офисы в сеть согласно схеме и настроить роутинг
* Все сервера и роутеры должны ходить в инет черз inetRouter
* Все сервера должны видеть друг друга
* у всех новых серверов отключить дефолт на нат (eth0), который вагрант поднимает для связи
* при нехватке сетевых интервейсов добавить по несколько адресов на интерфейс

## Script

```bash
scriptreplay --timing=timing.log --divisor=5 script.log
```

## Теоритическая часть

Свободные сети

Network | Netmask | N | Hostmin | Hostmax | Broadcast
---|---|---|---|---|---
192.168.0.16/28 | 255.255.255.240 | 14 | 192.168.0.17 | 192.168.0.30 | 192.168.0.31
192.168.0.48/28 | 255.255.255.240 | 14 | 192.168.0.49 | 192.168.0.62 | 192.168.0.63
192.168.0.128/25 | 	255.255.255.128 | 126 | 192.168.0.129 | 192.168.0.254 | 192.168.0.255
192.168.255.64/26 | 255.255.255.192 | 62 | 	192.168.255.65 | 192.168.255.126 | 	192.168.255.127
192.168.255.32/27 | 255.255.255.224 | 30 | 192.168.255.33 | 192.168.255.62 | 192.168.255.63
192.168.255.16/28 | 255.255.255.240 | 14 | 192.168.255.17 | 192.168.255.30 | 192.168.255.31
192.168.255.8/29 | 255.255.255.248 | 6 | 192.168.255.9 | 192.168.255.14 | 192.168.255.15
192.168.255.4/30 | 255.255.255.252 | 2 | 192.168.255.5 | 192.168.255.6 | 192.168.255.7

## Практическая часть

Реализована схема согласно *методичке*

```bash
vagrant up

vagrant ssh centralServer
traceroute 8.8.8.8
# --- контролируем, что проходим через интерфейсы:
#     192.168.0.1, 192.168.255.1
exit

vagrant ssh office1Server
traceroute 8.8.8.8
# --- контролируем, что проходим через интерфейсы:
#     192.168.1.129, 192.168.255.9, 192.168.255.1
exit

vagrant ssh office2Server
traceroute 8.8.8.8
# --- контролируем, что проходим через интерфейсы:
#     192.168.1.1, 192.168.255.5, 192.168.255.1
exit
```

Следует обратить внимание, что необходимо прописать статические маршруты,
чтобы всё заработало (в методически это указано не явно или совсем не
указано):

```bash
# inetRouter
192.168.0.0/22 via 192.168.255.2
192.168.255.4/30 via 192.168.255.2
192.168.255.8/30 via 192.168.255.2

# centralRouter
192.168.2.128/26 via 192.168.255.10
192.168.1.0/25 via 192.168.255.6
```

Кроме того, в методичке не указано, что на ВМ office1Router, office1Server,
office2Router, office2Server также необходимо направить весь трафик на
соответствующий *вышестоящий* маршрутизоватор.
